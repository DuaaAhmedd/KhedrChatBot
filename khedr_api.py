from flask import Flask, request, jsonify
import time

app = Flask(__name__)

def chatbot_response(user_input):
    user_input = user_input.strip().lower()
    
    if "مرحبا" in user_input or "السلام عليكم" in user_input or "هاي" in user_input:
        return "وعليكم السلام! أنا خضر، هنا لمساعدتك في زراعة الأشجار. ما الذي تريد مناقشته؟ (زراعة، أمراض، أنواع للشوارع، العناية والسماد)"
    
    elif "كيف أزرع" in user_input or "طرق الزراعة" in user_input or "زراعة شجرة" in user_input:
        return ("لزراعة شجرة: \n"
                "1. اختر مكانًا به شمس كافية وتربة جيدة التصريف.\n"
                "2. احفر حفرة بعمق وعرض ضعف حجم جذور الشجرة.\n"
                "3. ضع الشجرة في الحفرة، ثم أضف التربة وادكها برفق.\n"
                "4. اسقِ الشجرة جيدًا وأضف طبقة من المهاد (مثل القش) لحفظ الرطوبة.")
    
    elif "أمراض" in user_input or "مشاكل الأشجار" in user_input or "البياض الدقيقي" in user_input or "العفن الجذري" in user_input or "تسوس الجذع" in user_input:
        if "البياض الدقيقي" in user_input:
            return "البياض الدقيقي: بقع بيضاء على الأوراق، العلاج: مبيدات فطرية."
        elif "العفن الجذري" in user_input:
            return "العفن الجذري: بسبب الري الزائد، الحل: تحسين التصريف."
        elif "تسوس الجذع" in user_input:
            return "تسوس الجذع: بسبب الفطريات، الحل: تقليم الأجزاء المصابة."
        else:
            return ("من أشهر أمراض الأشجار:\n"
                    "- العفن الجذري: بسبب الري الزائد، الحل: تحسين التصريف.\n"
                    "- البياض الدقيقي: بقع بيضاء على الأوراق، العلاج: مبيدات فطرية.\n"
                    "- تسوس الجذع: بسبب الفطريات، الحل: تقليم الأجزاء المصابة.\n"
                    "هل تريد تفاصيل عن مرض معين؟")
    
    elif "أنواع" in user_input or "شوارع" in user_input or "أشجار للشارع" in user_input:
        return ("أنواع مناسبة للشوارع:\n"
                "- الزنزلخت: سريع النمو، ظل كثيف، يتحمل الجفاف.\n"
                "- الكافور: أوراق عطرية، مناسب للمدن.\n"
                "- النخيل: جمالي ويتحمل الحرارة.\n"
                "- الأكاسيا: قوية ومناسبة للمناطق الجافة.\n"
                "اختر نوعًا للشارع بناءً على مناخ منطقتك!")
    
    elif "عناية" in user_input or "اهتمام" in user_input or "ري" in user_input or "تقليم" in user_input or "تربة" in user_input or "سماد" in user_input:
        if "كيف أعتني" in user_input:
            return ("العناية بالأشجار تتطلب اهتمامًا دقيقًا ومستمرًا لضمان نموها بشكل صحي وقوي. الري المنتظم يعتمد على عمر الشجرة وحالة المناخ: الأشجار الصغيرة تحتاج إلى الري مرة إلى مرتين أسبوعيًا بكمية تتراوح بين 10 إلى 20 لترًا من الماء حسب نوع التربة وحجم الشجرة، بينما الأشجار الناضجة قد تكتفي بالري الطبيعي من الأمطار في المناطق الرطبة أو ريًا شهريًا في المناطق الجافة، مع تجنب الإفراط في الري لمنع تعفن الجذور. التقليم عملية أساسية للحفاظ على صحة الشجرة وجمالها، ويُنصح بإجرائها في أواخر الشتاء أو بداية الربيع قبل موسم النمو، حيث يتم إزالة الأغصان الميتة، المكسورة، أو المصابة بالأمراض باستخدام أدوات حادة ومعقمة لتجنب انتقال العدوى، كما يُساعد التقليم على تحسين تهوية الشجرة وزيادة تعرضها للشمس. الاهتمام بالتربة يشمل فحصها دوريًا للتأكد من أنها جيدة التصريف وخالية من التشبع بالماء، ويُفضل إضافة طبقة من المهاد العضوي مثل نشارة الخشب أو القش حول قاعدة الشجرة بسمك 5-10 سم للحفاظ على رطوبة التربة، تقليل نمو الأعشاب الضارة، وحماية الجذور من التغيرات الحرارية.")
        elif "متى أقلم" in user_input or "تقليم" in user_input:
            return "التقليم عملية أساسية للحفاظ على صحة الشجرة وجمالها، ويُنصح بإجرائها في أواخر الشتاء أو بداية الربيع قبل موسم النمو، حيث يتم إزالة الأغصان الميتة، المكسورة، أو المصابة بالأمراض باستخدام أدوات حادة ومعقمة لتجنب انتقال العدوى، كما يُساعد التقليم على تحسين تهوية الشجرة وزيادة تعرضها للشمس."
        elif "ري" in user_input or "كم مرة أسقي" in user_input:
            return "الري المنتظم يعتمد على عمر الشجرة وحالة المناخ: الأشجار الصغيرة تحتاج إلى الري مرة إلى مرتين أسبوعيًا بكمية تتراوح بين 10 إلى 20 لترًا من الماء حسب نوع التربة وحجم الشجرة، بينما الأشجار الناضجة قد تكتفي بالري الطبيعي من الأمطار في المناطق الرطبة أو ريًا شهريًا في المناطق الجافة، مع تجنب الإفراط في الري لمنع تعفن الجذور."
        elif "تربة" in user_input:
            return "الاهتمام بالتربة يشمل فحصها دوريًا للتأكد من أنها جيدة التصريف وخالية من التشبع بالماء، ويُفضل إضافة طبقة من المهاد العضوي مثل نشارة الخشب أو القش حول قاعدة الشجرة بسمك 5-10 سم للحفاظ على رطوبة التربة، تقليل نمو الأعشاب الضارة، وحماية الجذور من التغيرات الحرارية."
        elif "سماد" in user_input or "ما السماد" in user_input:
            return "السماد المناسب يختلف حسب احتياجات الشجرة: السماد العضوي مثل السماد البلدي المتحلل أو الكومبوست يُعتبر مثاليًا لتحسين خصوبة التربة ويُضاف بكمية 2-4 كجم حول الشجرة مرة سنويًا في الربيع، بينما السماد الكيميائي مثل NPK بنسبة 10-10-10 أو 20-10-10 يُستخدم لتعزيز النمو العام ويُطبق بمعدل 100-200 جرام لكل شجرة حسب حجمها وعمرها، مع توزيعه بالتساوي حول منطقة الجذور في الربيع أو الخريف، ويجب ري الشجرة بعد التسميد لضمان امتصاص العناصر الغذائية."
        else:
            return ("العناية بالأشجار تشمل الري المنتظم، التقليم، والتسميد. يمكنك السؤال عن 'كيف أعتني بالأشجار؟' أو 'متى أقلم الشجرة؟' أو 'ما السماد المناسب؟' لمزيد من التفاصيل.")
    
    elif "وداعًا" in user_input or "مع السلامة" in user_input or "خروج" in user_input:
        return "مع السلامة! أتمنى أن أكون قد ساعدتك في زراعة أشجارك."
    
    else:
        return "آسف، لم أفهم. يمكنك السؤال عن (طرق الزراعة، أمراض الأشجار، أنواع للشوارع، العناية والسماد). ما الذي تريد مناقشته؟"

@app.route('/')
def home():
    return app.send_static_file('index.html')

@app.route('/chat', methods=['POST'])
def chat():
    data = request.get_json()
    user_input = data.get('message', '')
    time.sleep(1)
    response = chatbot_response(user_input)
    return jsonify({'response': response})

if __name__ == '__main__':
    app.run(debug=True)